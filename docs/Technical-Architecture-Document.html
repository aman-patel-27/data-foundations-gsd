<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Data Reply Agentic Platform - Technical Architecture Document</title>
    <style>
        body { font-family: Calibri, Arial, sans-serif; margin: 40px; line-height: 1.6; }
        h1 { color: #1a365d; border-bottom: 3px solid #2563eb; padding-bottom: 10px; }
        h2 { color: #1e40af; border-bottom: 2px solid #3b82f6; padding-bottom: 8px; margin-top: 30px; }
        h3 { color: #1d4ed8; margin-top: 25px; }
        h4 { color: #2563eb; margin-top: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        th, td { border: 1px solid #d1d5db; padding: 10px; text-align: left; }
        th { background-color: #eff6ff; color: #1e40af; }
        tr:nth-child(even) { background-color: #f9fafb; }
        code { background-color: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-family: Consolas, monospace; }
        pre { background-color: #1f2937; color: #f9fafb; padding: 15px; border-radius: 8px; overflow-x: auto; }
        .highlight { background-color: #fef3c7; padding: 15px; border-left: 4px solid #f59e0b; margin: 15px 0; }
        .success { background-color: #d1fae5; padding: 15px; border-left: 4px solid #10b981; margin: 15px 0; }
        .info { background-color: #dbeafe; padding: 15px; border-left: 4px solid #3b82f6; margin: 15px 0; }
        .toc { background-color: #f8fafc; padding: 20px; border: 1px solid #e2e8f0; margin: 20px 0; }
        .toc ul { list-style-type: none; padding-left: 20px; }
        .toc a { text-decoration: none; color: #1e40af; }
        .page-break { page-break-before: always; }
    </style>
</head>
<body>

<h1>Data Reply Agentic Platform</h1>
<h2 style="border: none; color: #64748b; font-size: 18px;">Technical Architecture Document</h2>

<table style="width: 400px; margin-top: 30px;">
    <tr><td><strong>Version:</strong></td><td>1.0</td></tr>
    <tr><td><strong>Date:</strong></td><td>January 2025</td></tr>
    <tr><td><strong>Status:</strong></td><td>v1 MVP Complete</td></tr>
    <tr><td><strong>Author:</strong></td><td>Data Reply Engineering</td></tr>
</table>

<div class="toc">
    <h3>Table of Contents</h3>
    <ul>
        <li><a href="#executive-summary">1. Executive Summary</a></li>
        <li><a href="#platform-overview">2. Platform Overview</a></li>
        <li><a href="#module1">3. Module 1: Data Lineage & Quality</a></li>
        <li><a href="#module2">4. Module 2: Data Modelling (Planned)</a></li>
        <li><a href="#module3">5. Module 3: Scripts Conversion (Planned)</a></li>
        <li><a href="#tech-stack">6. Technology Stack</a></li>
        <li><a href="#architecture">7. System Architecture</a></li>
        <li><a href="#data-model">8. Data Model</a></li>
        <li><a href="#security">9. Security & Compliance</a></li>
        <li><a href="#deployment">10. Deployment Architecture</a></li>
        <li><a href="#apis">11. API Reference</a></li>
        <li><a href="#appendix">12. Appendix</a></li>
    </ul>
</div>

<div class="page-break"></div>

<h2 id="executive-summary">1. Executive Summary</h2>

<p>The <strong>Data Reply Agentic Platform</strong> is an AI-powered data management system designed to automate data quality, lineage tracking, and metadata management. The platform leverages AWS-native services and AI agents built on the Strands SDK with Amazon Bedrock (Claude) to provide intelligent automation.</p>

<div class="success">
    <strong>v1 MVP Status: COMPLETE</strong><br>
    24/24 requirements delivered across 4 phases, 12 execution plans.
</div>

<h3>Key Capabilities</h3>
<ul>
    <li><strong>Automated Data Profiling:</strong> Statistical analysis, type inference, and anomaly detection</li>
    <li><strong>AI-Powered Quality Rules:</strong> Natural language to DQDL conversion with reasoning</li>
    <li><strong>Column-Level Lineage:</strong> SQL-parsed data flow with transformation tracking</li>
    <li><strong>Real-Time Monitoring:</strong> Dashboard, alerts (Slack/email), and quality scores</li>
    <li><strong>OpenLineage Integration:</strong> Interoperability with Airflow, Spark, dbt</li>
    <li><strong>REST API:</strong> Programmatic access with Swagger documentation</li>
</ul>

<h3>Target Users</h3>
<table>
    <tr><th>User Type</th><th>Primary Use Cases</th><th>Scale</th></tr>
    <tr><td>Data Engineers</td><td>Pipeline monitoring, rule creation, validation</td><td>10-50 users</td></tr>
    <tr><td>Data Architects</td><td>Lineage analysis, impact assessment, governance</td><td></td></tr>
    <tr><td>Business Analysts</td><td>Data quality dashboards, trend analysis</td><td></td></tr>
    <tr><td>Developers</td><td>API integration, automation</td><td></td></tr>
</table>

<div class="page-break"></div>

<h2 id="platform-overview">2. Platform Overview</h2>

<h3>2.1 Three-Module Architecture</h3>

<p>The Data Reply Platform consists of three modules, with Module 1 fully implemented in v1:</p>

<table>
    <tr><th>Module</th><th>Description</th><th>Status</th></tr>
    <tr><td><strong>1. Data Lineage & Quality</strong></td><td>Profiling, quality rules, validation, lineage tracking</td><td style="color: green;">v1 Complete</td></tr>
    <tr><td><strong>2. Data Modelling</strong></td><td>Schema design, ER diagrams, model versioning</td><td style="color: orange;">v2 Planned</td></tr>
    <tr><td><strong>3. Scripts Conversion</strong></td><td>SQL dialect migration, code transformation</td><td style="color: orange;">v2 Planned</td></tr>
</table>

<h3>2.2 Design Principles</h3>

<ol>
    <li><strong>AI-First:</strong> Agents automate repetitive tasks; humans approve and guide</li>
    <li><strong>AWS-Native:</strong> Leverage managed services (Bedrock, Glue, Step Functions)</li>
    <li><strong>Serverless:</strong> Lambda + Fargate for cost-effective scaling</li>
    <li><strong>Standard Protocols:</strong> OpenLineage for interoperability</li>
    <li><strong>Developer Experience:</strong> TypeScript frontend, Python agents, REST APIs</li>
</ol>

<div class="page-break"></div>

<h2 id="module1">3. Module 1: Data Lineage & Quality</h2>

<div class="success">
    <strong>Status: v1 MVP Complete</strong><br>
    4 phases executed, 24 requirements delivered
</div>

<h3>3.1 Phase Breakdown</h3>

<table>
    <tr><th>Phase</th><th>Description</th><th>Plans</th><th>Requirements</th></tr>
    <tr><td>1. Foundation & Data Profiling</td><td>Infrastructure, connectors, profiler agent</td><td>3</td><td>PROF-01 to PROF-04, INT-04</td></tr>
    <tr><td>2. Data Quality & AI Recommendations</td><td>DQ rules, AI generation, validation</td><td>4</td><td>DQ-01 to DQ-04, AI-01 to AI-04, INT-03</td></tr>
    <tr><td>3. Column-Level Lineage</td><td>SQL parsing, lineage graph, impact analysis</td><td>3</td><td>LIN-01 to LIN-04, INT-02</td></tr>
    <tr><td>4. Visibility & Integration</td><td>Dashboard, alerts, REST API</td><td>2</td><td>VIS-01 to VIS-04, INT-01</td></tr>
</table>

<h3>3.2 AI Agents</h3>

<h4>3.2.1 Data Profiler Agent</h4>
<table>
    <tr><th>Property</th><th>Value</th></tr>
    <tr><td>Framework</td><td>Strands Agents SDK</td></tr>
    <tr><td>Runtime</td><td>ECS Fargate (Python 3.11)</td></tr>
    <tr><td>AI Model</td><td>Amazon Bedrock (Claude 3.5 Sonnet)</td></tr>
</table>

<p><strong>Tools:</strong></p>
<ul>
    <li><code>profile_table(source_id, table_name)</code> - Generates column statistics using ydata-profiling</li>
    <li><code>detect_anomalies(profile_id)</code> - Z-score and IQR-based anomaly detection</li>
    <li><code>infer_types(column_data)</code> - Automatic data type and format inference</li>
</ul>

<h4>3.2.2 DQ Recommender Agent</h4>
<table>
    <tr><th>Property</th><th>Value</th></tr>
    <tr><td>Framework</td><td>Strands Agents SDK</td></tr>
    <tr><td>Runtime</td><td>AWS Lambda (Python 3.11)</td></tr>
    <tr><td>AI Model</td><td>Amazon Bedrock (Claude 3.5 Sonnet)</td></tr>
</table>

<p><strong>Tools:</strong></p>
<ul>
    <li><code>generate_rule(description, context)</code> - Natural language to DQDL conversion</li>
    <li><code>apply_template(template_id, params)</code> - Industry-standard rule templates (13 categories)</li>
    <li><code>suggest_remediation(issue_type)</code> - AI-powered fix suggestions (8 remediation types)</li>
    <li><code>explain_rule(rule_code)</code> - Human-readable rule explanations</li>
</ul>

<h4>3.2.3 Lineage Agent</h4>
<table>
    <tr><th>Property</th><th>Value</th></tr>
    <tr><td>Framework</td><td>Strands Agents SDK</td></tr>
    <tr><td>Runtime</td><td>AWS Lambda (Python 3.11)</td></tr>
    <tr><td>SQL Parser</td><td>SQLGlot (20+ SQL dialects)</td></tr>
</table>

<p><strong>Tools:</strong></p>
<ul>
    <li><code>parse_sql_lineage(sql)</code> - Column-level lineage extraction with transformation types</li>
    <li><code>get_downstream_impact(node_id)</code> - Forward traversal for impact analysis</li>
    <li><code>get_upstream_sources(node_id)</code> - Backward traversal for root cause analysis</li>
    <li><code>emit_openlineage_event(event)</code> - OpenLineage event producer</li>
</ul>

<h3>3.3 Data Connectors</h3>

<table>
    <tr><th>Source Type</th><th>Connection Method</th><th>Capabilities</th></tr>
    <tr><td>Amazon Athena</td><td>boto3 athena client</td><td>Query, profile, lineage extraction</td></tr>
    <tr><td>Amazon Redshift</td><td>Redshift Data API</td><td>Query, profile, query log lineage</td></tr>
    <tr><td>S3/Iceberg</td><td>PyIceberg + boto3</td><td>Table scan, schema inference</td></tr>
    <tr><td>AWS Glue Catalog</td><td>boto3 glue client</td><td>Metadata discovery</td></tr>
</table>

<h3>3.4 Quality Validation Pipeline</h3>

<pre>
┌─────────────┐     ┌──────────────┐     ┌─────────────┐
│   Rule      │────▶│ Step         │────▶│  AWS Glue   │
│   Created   │     │ Functions    │     │  Data       │
└─────────────┘     │ Workflow     │     │  Quality    │
                    └──────────────┘     └─────────────┘
                           │                    │
                           ▼                    ▼
                    ┌──────────────┐     ┌─────────────┐
                    │   Human      │     │  Results    │
                    │   Approval   │     │  Stored     │
                    │   (optional) │     │  Supabase   │
                    └──────────────┘     └─────────────┘
                                               │
                                               ▼
                                        ┌─────────────┐
                                        │ EventBridge │
                                        │   Alert     │
                                        └─────────────┘
                                               │
                              ┌────────────────┼────────────────┐
                              ▼                ▼                ▼
                        ┌──────────┐    ┌──────────┐    ┌──────────┐
                        │  Slack   │    │  Email   │    │ Dashboard│
                        └──────────┘    └──────────┘    └──────────┘
</pre>

<h3>3.5 Lineage Graph Model</h3>

<p>The lineage system uses a directed graph with three node types and transformation-aware edges:</p>

<table>
    <tr><th>Node Type</th><th>Description</th><th>Example</th></tr>
    <tr><td>dataset</td><td>Table or file</td><td>redshift://analytics/sales</td></tr>
    <tr><td>column</td><td>Column within dataset</td><td>order_date, customer_id</td></tr>
    <tr><td>job</td><td>Transformation job</td><td>ETL pipeline, SQL query</td></tr>
</table>

<table>
    <tr><th>Edge Type</th><th>Transformation</th><th>Description</th></tr>
    <tr><td>DIRECT</td><td>IDENTITY</td><td>Direct copy without modification</td></tr>
    <tr><td>DIRECT</td><td>TRANSFORMATION</td><td>Calculated/derived value</td></tr>
    <tr><td>DIRECT</td><td>AGGREGATION</td><td>SUM, COUNT, AVG, etc.</td></tr>
    <tr><td>INDIRECT</td><td>JOIN</td><td>Used in join condition</td></tr>
    <tr><td>INDIRECT</td><td>FILTER</td><td>Used in WHERE clause</td></tr>
    <tr><td>INDIRECT</td><td>GROUP_BY</td><td>Used in GROUP BY</td></tr>
</table>

<div class="page-break"></div>

<h2 id="module2">4. Module 2: Data Modelling (Planned)</h2>

<div class="highlight">
    <strong>Status: v2 Planned</strong><br>
    Target capabilities for future development
</div>

<h3>4.1 Planned Capabilities</h3>

<ul>
    <li><strong>Visual Schema Designer:</strong> Drag-and-drop ER diagram editor</li>
    <li><strong>AI-Assisted Modelling:</strong> Generate schemas from natural language descriptions</li>
    <li><strong>Model Versioning:</strong> Track schema changes over time</li>
    <li><strong>DDL Generation:</strong> Export to multiple SQL dialects</li>
    <li><strong>Documentation:</strong> Auto-generate data dictionaries</li>
    <li><strong>Lineage Integration:</strong> Link models to actual data sources</li>
</ul>

<h3>4.2 Proposed Architecture</h3>

<table>
    <tr><th>Component</th><th>Technology</th></tr>
    <tr><td>Schema Editor</td><td>React Flow (same as lineage)</td></tr>
    <tr><td>Model Storage</td><td>Supabase (new tables)</td></tr>
    <tr><td>AI Agent</td><td>Strands SDK + Bedrock</td></tr>
    <tr><td>DDL Generator</td><td>SQLGlot transpilation</td></tr>
</table>

<div class="page-break"></div>

<h2 id="module3">5. Module 3: Scripts Conversion (Planned)</h2>

<div class="highlight">
    <strong>Status: v2 Planned</strong><br>
    Target capabilities for future development
</div>

<h3>5.1 Planned Capabilities</h3>

<ul>
    <li><strong>SQL Dialect Conversion:</strong> Oracle to Redshift, SQL Server to Athena, etc.</li>
    <li><strong>Stored Procedure Migration:</strong> PL/SQL to Python/Lambda</li>
    <li><strong>AI-Assisted Refactoring:</strong> Optimize queries with Claude suggestions</li>
    <li><strong>Batch Processing:</strong> Convert entire codebases</li>
    <li><strong>Validation:</strong> Compare query results before/after conversion</li>
</ul>

<h3>5.2 Proposed Architecture</h3>

<table>
    <tr><th>Component</th><th>Technology</th></tr>
    <tr><td>SQL Parser</td><td>SQLGlot (extends existing)</td></tr>
    <tr><td>Conversion Engine</td><td>Strands Agent + Bedrock</td></tr>
    <tr><td>Code Editor</td><td>Monaco Editor (VS Code)</td></tr>
    <tr><td>Diff Viewer</td><td>react-diff-viewer</td></tr>
</table>

<div class="page-break"></div>

<h2 id="tech-stack">6. Technology Stack</h2>

<h3>6.1 Frontend</h3>

<table>
    <tr><th>Technology</th><th>Version</th><th>Purpose</th></tr>
    <tr><td>Next.js</td><td>15.x</td><td>React framework with App Router</td></tr>
    <tr><td>React</td><td>19.x</td><td>UI library</td></tr>
    <tr><td>TypeScript</td><td>5.x</td><td>Type safety</td></tr>
    <tr><td>TanStack Query</td><td>5.x</td><td>Data fetching and caching</td></tr>
    <tr><td>Recharts</td><td>2.14.x</td><td>Dashboard charts</td></tr>
    <tr><td>React Flow</td><td>12.x</td><td>Lineage visualization</td></tr>
    <tr><td>Tailwind CSS</td><td>3.x</td><td>Styling</td></tr>
    <tr><td>shadcn/ui</td><td>latest</td><td>Component library</td></tr>
</table>

<h3>6.2 Backend / AI</h3>

<table>
    <tr><th>Technology</th><th>Version</th><th>Purpose</th></tr>
    <tr><td>Python</td><td>3.11</td><td>Agent runtime</td></tr>
    <tr><td>Strands Agents SDK</td><td>latest</td><td>AI agent framework</td></tr>
    <tr><td>Amazon Bedrock</td><td>-</td><td>Claude 3.5 Sonnet LLM</td></tr>
    <tr><td>SQLGlot</td><td>25.x</td><td>SQL parsing (20+ dialects)</td></tr>
    <tr><td>ydata-profiling</td><td>4.x</td><td>Data profiling</td></tr>
    <tr><td>OpenLineage</td><td>1.x</td><td>Lineage standard</td></tr>
</table>

<h3>6.3 AWS Services</h3>

<table>
    <tr><th>Service</th><th>Purpose</th></tr>
    <tr><td>Lambda</td><td>Serverless functions (validators, notifiers, extractors)</td></tr>
    <tr><td>ECS Fargate</td><td>Container runtime for profiler agent</td></tr>
    <tr><td>Step Functions</td><td>Validation workflow orchestration</td></tr>
    <tr><td>EventBridge</td><td>Event routing and scheduling</td></tr>
    <tr><td>Glue Data Quality</td><td>DQDL rule execution</td></tr>
    <tr><td>SNS/SES</td><td>Notifications (Slack, email)</td></tr>
    <tr><td>S3</td><td>Data lake storage</td></tr>
    <tr><td>Secrets Manager</td><td>Credential storage</td></tr>
    <tr><td>CDK</td><td>Infrastructure as code</td></tr>
</table>

<h3>6.4 Database</h3>

<table>
    <tr><th>Technology</th><th>Purpose</th></tr>
    <tr><td>Supabase</td><td>Managed PostgreSQL with RLS, real-time subscriptions</td></tr>
    <tr><td>PostgreSQL</td><td>Metadata storage, recursive CTEs for graph queries</td></tr>
</table>

<h3>6.5 Deployment</h3>

<table>
    <tr><th>Platform</th><th>Component</th></tr>
    <tr><td>Vercel</td><td>Next.js frontend, API routes</td></tr>
    <tr><td>AWS</td><td>Lambda, ECS, Step Functions, etc.</td></tr>
    <tr><td>Supabase Cloud</td><td>PostgreSQL database</td></tr>
</table>

<div class="page-break"></div>

<h2 id="architecture">7. System Architecture</h2>

<h3>7.1 High-Level Architecture</h3>

<pre>
┌─────────────────────────────────────────────────────────────────────────────┐
│                              USERS                                          │
│         Data Architects    Data Engineers    Business Analysts    Devs      │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         FRONTEND (Vercel)                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │  Dashboard  │  │   Sources   │  │    Rules    │  │   Lineage   │        │
│  │  /overview  │  │   /sources  │  │   /rules    │  │   /lineage  │        │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐       │
│  │                    REST API (/api/v1/*)                         │       │
│  │    /datasets    /quality-scores    /alerts    /openlineage      │       │
│  └─────────────────────────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    ▼                 ▼                 ▼
┌──────────────────────┐ ┌──────────────────┐ ┌──────────────────────────────┐
│   PROFILER AGENT     │ │  DQ RECOMMENDER  │ │      LINEAGE AGENT           │
│   (ECS Fargate)      │ │  (Lambda)        │ │      (Lambda)                │
│                      │ │                  │ │                              │
│  • profile_table()   │ │ • generate_rule()│ │ • parse_sql_lineage()        │
│  • detect_anomalies()│ │ • apply_template │ │ • get_downstream_impact()    │
│  • infer_types()     │ │ • suggest_fix()  │ │ • emit_openlineage_event()   │
└──────────────────────┘ └──────────────────┘ └──────────────────────────────┘
           │                      │                        │
           └──────────────────────┼────────────────────────┘
                                  ▼
                    ┌─────────────────────────┐
                    │    Amazon Bedrock       │
                    │    (Claude 3.5 Sonnet)  │
                    └─────────────────────────┘
                                  │
           ┌──────────────────────┼──────────────────────┐
           ▼                      ▼                      ▼
┌──────────────────┐   ┌──────────────────┐   ┌──────────────────┐
│  Step Functions  │   │  AWS Glue DQ     │   │   EventBridge    │
│  (Workflows)     │   │  (Validation)    │   │   (Events)       │
└──────────────────┘   └──────────────────┘   └──────────────────┘
                                  │
                    ┌─────────────┼─────────────┐
                    ▼             ▼             ▼
             ┌──────────┐ ┌──────────┐ ┌──────────┐
             │  Slack   │ │  Email   │ │ Dashboard│
             │  Alerts  │ │  (SES)   │ │  Update  │
             └──────────┘ └──────────┘ └──────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SUPABASE (PostgreSQL)                                │
│                                                                             │
│  data_sources │ profiles │ dq_rules │ validation_results │ alerts          │
│  lineage_nodes │ lineage_edges │ quality_scores                            │
└─────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DATA SOURCES                                      │
│     Amazon Athena    │    Amazon Redshift    │    S3/Iceberg    │    Glue   │
└─────────────────────────────────────────────────────────────────────────────┘
</pre>

<h3>7.2 Component Interactions</h3>

<h4>7.2.1 Data Profiling Flow</h4>
<ol>
    <li>User creates data source connection in UI</li>
    <li>User triggers profile for a table</li>
    <li>Profiler Agent queries data source via connector</li>
    <li>Agent runs ydata-profiling with <code>minimal=True</code></li>
    <li>Results stored in Supabase (profiles, column_profiles)</li>
    <li>Anomalies detected and flagged</li>
    <li>UI displays profile with stats and anomalies</li>
</ol>

<h4>7.2.2 Quality Rule Generation Flow</h4>
<ol>
    <li>User describes rule in natural language</li>
    <li>DQ Recommender Agent processes with Bedrock</li>
    <li>Agent generates DQDL code with reasoning</li>
    <li>Rule saved to Supabase (dq_rules) with "pending" status</li>
    <li>Optional: Human approval via Step Functions</li>
    <li>Approved rules activated for validation</li>
</ol>

<h4>7.2.3 Validation Execution Flow</h4>
<ol>
    <li>Step Functions workflow triggered (scheduled or manual)</li>
    <li>Lambda fetches active rules for dataset</li>
    <li>AWS Glue Data Quality executes DQDL rules</li>
    <li>Results parsed and stored in validation_results</li>
    <li>If failures: Alert created, EventBridge event emitted</li>
    <li>Notification Lambdas send Slack/email alerts</li>
</ol>

<h4>7.2.4 Lineage Extraction Flow</h4>
<ol>
    <li>Scheduled Lambda queries Redshift SVL_STATEMENTTEXT / Athena history</li>
    <li>SQLGlot parses SQL to extract column dependencies</li>
    <li>Transformation types classified (DIRECT/INDIRECT, subtypes)</li>
    <li>Nodes and edges upserted to lineage_nodes/lineage_edges</li>
    <li>OpenLineage events optionally emitted to external systems</li>
</ol>

<div class="page-break"></div>

<h2 id="data-model">8. Data Model</h2>

<h3>8.1 Database Schema Overview</h3>

<p>The platform uses 5 Supabase migrations creating 15+ tables:</p>

<table>
    <tr><th>Migration</th><th>Tables</th><th>Purpose</th></tr>
    <tr><td>001_profile_schema.sql</td><td>data_sources, profiles, column_profiles, anomalies, profile_jobs, profile_comparisons</td><td>Data profiling metadata</td></tr>
    <tr><td>002_dq_rules.sql</td><td>dq_rules, rule_templates, rule_approvals</td><td>Quality rule management</td></tr>
    <tr><td>003_validation_results.sql</td><td>validation_runs, validation_results, alerts, freshness_checks, volume_checks</td><td>Validation execution tracking</td></tr>
    <tr><td>004_lineage_schema.sql</td><td>lineage_nodes, lineage_edges, lineage_runs</td><td>Data lineage graph</td></tr>
    <tr><td>005_quality_trends.sql</td><td>quality_scores (+ 4 functions)</td><td>Dashboard aggregations</td></tr>
</table>

<h3>8.2 Key Tables</h3>

<h4>data_sources</h4>
<pre>
CREATE TABLE data_sources (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    source_type VARCHAR(50) NOT NULL,  -- athena, redshift, iceberg
    connection_config JSONB NOT NULL,
    created_at TIMESTAMPTZ,
    updated_at TIMESTAMPTZ
);
</pre>

<h4>lineage_nodes</h4>
<pre>
CREATE TABLE lineage_nodes (
    id UUID PRIMARY KEY,
    node_type VARCHAR(20) NOT NULL,    -- dataset, column, job
    namespace VARCHAR(500) NOT NULL,   -- redshift://cluster/db
    name VARCHAR(255) NOT NULL,
    parent_id UUID REFERENCES lineage_nodes(id),
    data_type VARCHAR(100),
    metadata JSONB DEFAULT '{}'
);
</pre>

<h4>lineage_edges</h4>
<pre>
CREATE TABLE lineage_edges (
    id UUID PRIMARY KEY,
    source_id UUID REFERENCES lineage_nodes(id),
    target_id UUID REFERENCES lineage_nodes(id),
    edge_type VARCHAR(50),             -- derives_from, transforms_to
    transformation_type VARCHAR(50),   -- DIRECT, INDIRECT
    transformation_subtype VARCHAR(50),-- IDENTITY, JOIN, AGGREGATION, etc.
    transformation_description TEXT,
    sql_hash VARCHAR(64)
);
</pre>

<h3>8.3 PostgreSQL Functions</h3>

<table>
    <tr><th>Function</th><th>Purpose</th></tr>
    <tr><td><code>get_downstream_nodes(node_id, max_depth)</code></td><td>Recursive CTE for forward lineage traversal</td></tr>
    <tr><td><code>get_upstream_nodes(node_id, max_depth)</code></td><td>Recursive CTE for backward lineage traversal</td></tr>
    <tr><td><code>get_quality_trends(dataset_id, days)</code></td><td>Daily quality scores with 7-day rolling average</td></tr>
    <tr><td><code>get_composite_quality_score(dataset_id)</code></td><td>Weighted quality score across dimensions</td></tr>
    <tr><td><code>get_dashboard_stats()</code></td><td>Aggregated statistics for dashboard overview</td></tr>
</table>

<div class="page-break"></div>

<h2 id="security">9. Security & Compliance</h2>

<h3>9.1 Authentication & Authorization</h3>

<table>
    <tr><th>Layer</th><th>Method</th></tr>
    <tr><td>Frontend</td><td>Supabase Auth (email/password, SSO via SAML)</td></tr>
    <tr><td>API Routes</td><td>Supabase JWT verification</td></tr>
    <tr><td>AWS Services</td><td>IAM roles with least privilege</td></tr>
    <tr><td>Database</td><td>Row Level Security (RLS) policies</td></tr>
</table>

<h3>9.2 Data Security</h3>

<ul>
    <li><strong>Encryption at Rest:</strong> Supabase (AES-256), S3 (SSE-S3/SSE-KMS)</li>
    <li><strong>Encryption in Transit:</strong> TLS 1.3 for all connections</li>
    <li><strong>Secrets Management:</strong> AWS Secrets Manager for credentials</li>
    <li><strong>No Data Storage:</strong> Platform stores metadata only, not source data</li>
</ul>

<h3>9.3 Network Security</h3>

<ul>
    <li>VPC isolation for ECS Fargate tasks</li>
    <li>Security groups restrict Lambda egress</li>
    <li>Supabase connection pooling with SSL</li>
</ul>

<h3>9.4 Compliance Considerations</h3>

<ul>
    <li>AWS services are SOC 2, ISO 27001, GDPR compliant</li>
    <li>Supabase is SOC 2 Type II certified</li>
    <li>Audit logging via CloudTrail and Supabase logs</li>
</ul>

<div class="page-break"></div>

<h2 id="deployment">10. Deployment Architecture</h2>

<h3>10.1 Infrastructure as Code</h3>

<p>All AWS infrastructure is defined in CDK (TypeScript):</p>

<pre>
infra/
├── bin/
│   └── infra.ts           # CDK app entry point
├── lib/
│   ├── profiler-stack.ts  # VPC, ECS, Step Functions
│   ├── data-stack.ts      # S3 buckets
│   ├── validator-stack.ts # Validation Lambdas, Glue DQ
│   ├── lineage-stack.ts   # Lineage extraction Lambdas
│   └── notification-stack.ts # Slack/email notifiers
└── cdk.json
</pre>

<h3>10.2 Deployment Commands</h3>

<pre>
# Deploy all stacks
cd infra && cdk deploy --all

# Deploy specific stack
cdk deploy NotificationStack

# View differences
cdk diff
</pre>

<h3>10.3 Environment Configuration</h3>

<table>
    <tr><th>Variable</th><th>Location</th><th>Purpose</th></tr>
    <tr><td>NEXT_PUBLIC_SUPABASE_URL</td><td>Vercel</td><td>Supabase project URL</td></tr>
    <tr><td>NEXT_PUBLIC_SUPABASE_ANON_KEY</td><td>Vercel</td><td>Supabase anon key</td></tr>
    <tr><td>SLACK_WEBHOOK_URL</td><td>Secrets Manager</td><td>Slack notifications</td></tr>
    <tr><td>ALERT_EMAIL_FROM</td><td>Lambda env</td><td>SES sender address</td></tr>
</table>

<div class="page-break"></div>

<h2 id="apis">11. API Reference</h2>

<h3>11.1 REST API Endpoints</h3>

<p>Base URL: <code>https://data-foundations-reply.vercel.app/api/v1</code></p>

<table>
    <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
    <tr><td>GET</td><td>/datasets</td><td>List all data sources with profiles</td></tr>
    <tr><td>GET</td><td>/datasets/:id</td><td>Get dataset details</td></tr>
    <tr><td>GET</td><td>/quality-scores</td><td>List quality scores by dataset</td></tr>
    <tr><td>GET</td><td>/quality-scores/:datasetId/trends</td><td>Get historical trends</td></tr>
    <tr><td>GET</td><td>/alerts</td><td>List alerts with filtering</td></tr>
    <tr><td>PATCH</td><td>/alerts/:id/acknowledge</td><td>Acknowledge an alert</td></tr>
    <tr><td>POST</td><td>/openlineage</td><td>Receive OpenLineage events</td></tr>
</table>

<h3>11.2 OpenLineage Integration</h3>

<p>The platform can receive and emit OpenLineage events:</p>

<h4>Receive Events (Consumer)</h4>
<pre>
POST /api/v1/openlineage
Content-Type: application/json

{
  "eventType": "COMPLETE",
  "eventTime": "2025-01-19T00:00:00Z",
  "run": { "runId": "..." },
  "job": { "namespace": "airflow", "name": "etl_job" },
  "outputs": [{
    "namespace": "redshift://cluster",
    "name": "analytics.sales",
    "facets": {
      "columnLineage": {
        "fields": {
          "total_revenue": {
            "inputFields": [
              { "namespace": "...", "name": "...", "field": "amount" }
            ],
            "transformationType": "DIRECT",
            "transformationDescription": "SUM(amount)"
          }
        }
      }
    }
  }]
}
</pre>

<h3>11.3 Swagger Documentation</h3>

<p>Interactive API documentation available at: <code>/api/docs</code></p>

<div class="page-break"></div>

<h2 id="appendix">12. Appendix</h2>

<h3>12.1 Requirements Traceability</h3>

<table>
    <tr><th>REQ-ID</th><th>Description</th><th>Phase</th><th>Status</th></tr>
    <tr><td>PROF-01</td><td>Automated statistics</td><td>1</td><td>Complete</td></tr>
    <tr><td>PROF-02</td><td>Type inference</td><td>1</td><td>Complete</td></tr>
    <tr><td>PROF-03</td><td>Distribution analysis</td><td>1</td><td>Complete</td></tr>
    <tr><td>PROF-04</td><td>Anomaly detection</td><td>1</td><td>Complete</td></tr>
    <tr><td>DQ-01</td><td>Quality checks</td><td>2</td><td>Complete</td></tr>
    <tr><td>DQ-02</td><td>Schema validation</td><td>2</td><td>Complete</td></tr>
    <tr><td>DQ-03</td><td>Freshness monitoring</td><td>2</td><td>Complete</td></tr>
    <tr><td>DQ-04</td><td>Volume anomalies</td><td>2</td><td>Complete</td></tr>
    <tr><td>AI-01</td><td>NL to validation code</td><td>2</td><td>Complete</td></tr>
    <tr><td>AI-02</td><td>Rule reasoning</td><td>2</td><td>Complete</td></tr>
    <tr><td>AI-03</td><td>Rule templates</td><td>2</td><td>Complete</td></tr>
    <tr><td>AI-04</td><td>Remediation suggestions</td><td>2</td><td>Complete</td></tr>
    <tr><td>LIN-01</td><td>Column-to-column flow</td><td>3</td><td>Complete</td></tr>
    <tr><td>LIN-02</td><td>Transformation logic</td><td>3</td><td>Complete</td></tr>
    <tr><td>LIN-03</td><td>Downstream impact</td><td>3</td><td>Complete</td></tr>
    <tr><td>LIN-04</td><td>Root cause tracing</td><td>3</td><td>Complete</td></tr>
    <tr><td>VIS-01</td><td>Slack/email alerts</td><td>4</td><td>Complete</td></tr>
    <tr><td>VIS-02</td><td>Quality dashboard</td><td>4</td><td>Complete</td></tr>
    <tr><td>VIS-03</td><td>Quality scores</td><td>4</td><td>Complete</td></tr>
    <tr><td>VIS-04</td><td>Historical trends</td><td>4</td><td>Complete</td></tr>
    <tr><td>INT-01</td><td>REST API</td><td>4</td><td>Complete</td></tr>
    <tr><td>INT-02</td><td>OpenLineage</td><td>3</td><td>Complete</td></tr>
    <tr><td>INT-03</td><td>Step Functions</td><td>2</td><td>Complete</td></tr>
    <tr><td>INT-04</td><td>Athena/Redshift</td><td>1</td><td>Complete</td></tr>
</table>

<h3>12.2 File Structure</h3>

<pre>
data-foundations-gsd/
├── .planning/              # GSD planning files
│   ├── PROJECT.md
│   ├── ROADMAP.md
│   ├── REQUIREMENTS.md
│   └── phases/
├── agents/                 # AI agents (Python)
│   ├── profiler/
│   ├── dq_recommender/
│   └── lineage/
├── frontend/               # Next.js app
│   ├── src/
│   │   ├── app/
│   │   ├── components/
│   │   ├── hooks/
│   │   └── lib/
│   └── package.json
├── infra/                  # AWS CDK
│   └── lib/
├── lambdas/                # Lambda functions
│   ├── validator/
│   ├── alert_handler/
│   ├── slack_notifier/
│   ├── email_notifier/
│   └── lineage_extractor/
├── supabase/
│   └── migrations/
├── docs/                   # Documentation
└── scripts/                # Setup scripts
</pre>

<h3>12.3 Glossary</h3>

<table>
    <tr><th>Term</th><th>Definition</th></tr>
    <tr><td>DQDL</td><td>Data Quality Definition Language (AWS Glue)</td></tr>
    <tr><td>OpenLineage</td><td>Open standard for data lineage metadata</td></tr>
    <tr><td>Strands SDK</td><td>AWS framework for building AI agents</td></tr>
    <tr><td>RLS</td><td>Row Level Security (PostgreSQL)</td></tr>
    <tr><td>SQLGlot</td><td>SQL parser supporting 20+ dialects</td></tr>
</table>

<hr>
<p style="text-align: center; color: #64748b; margin-top: 40px;">
    Data Reply Agentic Platform - Technical Architecture Document v1.0<br>
    January 2025
</p>

</body>
</html>