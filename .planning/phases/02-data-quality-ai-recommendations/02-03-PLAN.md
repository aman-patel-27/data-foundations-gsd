---
phase: 02-data-quality-ai-recommendations
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/app/(dashboard)/rules/page.tsx
  - frontend/src/app/(dashboard)/rules/new/page.tsx
  - frontend/src/app/(dashboard)/rules/[id]/page.tsx
  - frontend/src/app/(dashboard)/validations/page.tsx
  - frontend/src/app/(dashboard)/validations/[id]/page.tsx
  - frontend/src/app/(dashboard)/alerts/page.tsx
  - frontend/src/components/features/rules/rule-form.tsx
  - frontend/src/components/features/rules/rule-list.tsx
  - frontend/src/components/features/rules/rule-generator.tsx
  - frontend/src/components/features/rules/approval-panel.tsx
  - frontend/src/components/features/validations/validation-list.tsx
  - frontend/src/components/features/validations/validation-results.tsx
  - frontend/src/components/features/alerts/alert-list.tsx
  - frontend/src/components/features/alerts/alert-detail.tsx
  - frontend/src/hooks/use-rules.ts
  - frontend/src/hooks/use-validations.ts
  - frontend/src/hooks/use-alerts.ts
autonomous: true

must_haves:
  truths:
    - "User can create quality rules via natural language description"
    - "User can see AI-provided reasoning for suggested rules"
    - "User can approve or reject pending AI-generated rules"
    - "User can view validation results with pass/fail per rule"
    - "User can see and manage alerts with severity indicators"
  artifacts:
    - path: "frontend/src/app/(dashboard)/rules/new/page.tsx"
      provides: "Rule creation page with AI generator"
      min_lines: 50
    - path: "frontend/src/components/features/rules/rule-generator.tsx"
      provides: "Natural language to rule AI interface"
      exports: ["RuleGenerator"]
    - path: "frontend/src/components/features/rules/approval-panel.tsx"
      provides: "Pending rule approval UI"
      exports: ["ApprovalPanel"]
    - path: "frontend/src/components/features/validations/validation-results.tsx"
      provides: "Validation run results display"
      exports: ["ValidationResults"]
    - path: "frontend/src/components/features/alerts/alert-list.tsx"
      provides: "Alert dashboard with severity"
      exports: ["AlertList"]
  key_links:
    - from: "frontend/src/components/features/rules/rule-generator.tsx"
      to: "DQ Recommender agent"
      via: "API call to backend"
      pattern: "fetch.*api/rules/generate|useMutation.*generate"
    - from: "frontend/src/hooks/use-rules.ts"
      to: "Supabase dq_rules table"
      via: "TanStack Query + Supabase"
      pattern: "useQuery.*from.*dq_rules"
    - from: "frontend/src/components/features/rules/approval-panel.tsx"
      to: "backend/api/rules/[id]/approve"
      via: "POST request"
      pattern: "fetch.*approve|useMutation.*approve"
---

<objective>
Build the frontend for quality rule management, validation results viewing, and alert dashboard.

Purpose: Complete the user experience for Phase 2 by enabling users to create rules via natural language, review AI suggestions, approve rules, view validation results, and manage alerts.

Output: Working frontend pages for rules, validations, and alerts with full CRUD and AI integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-data-quality-ai-recommendations/02-RESEARCH.md
@.planning/phases/02-data-quality-ai-recommendations/02-01-SUMMARY.md
@.planning/phases/01-foundation-data-profiling/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rule Management UI with AI Generator</name>
  <files>
    frontend/src/app/(dashboard)/rules/page.tsx
    frontend/src/app/(dashboard)/rules/new/page.tsx
    frontend/src/app/(dashboard)/rules/[id]/page.tsx
    frontend/src/components/features/rules/rule-form.tsx
    frontend/src/components/features/rules/rule-list.tsx
    frontend/src/components/features/rules/rule-generator.tsx
    frontend/src/components/features/rules/approval-panel.tsx
    frontend/src/components/features/rules/template-picker.tsx
    frontend/src/hooks/use-rules.ts
  </files>
  <action>
    Create rule management pages and AI-powered rule generator:

    **src/hooks/use-rules.ts:**
    - `useRules(filters?)`: List dq_rules from Supabase with filters (dataset_id, status, rule_type)
    - `useRule(id)`: Get single rule with full details
    - `usePendingRules()`: Get rules with status='pending' for approval queue
    - `useCreateRule()`: Mutation to create rule via API
    - `useApproveRule()`: Mutation to POST /api/rules/{id}/approve
    - `useRejectRule()`: Mutation to POST /api/rules/{id}/reject
    - `useGenerateRule()`: Mutation to call DQ Recommender agent via API
    - Proper cache invalidation on mutations

    **src/components/features/rules/rule-generator.tsx:**
    AI-powered rule creation interface:
    - Dataset selector (from use-sources hook)
    - Column selector (populated from dataset schema)
    - Natural language description textarea
    - "Generate Rule" button that calls DQ Recommender agent
    - Loading state with "AI is analyzing..." message
    - Response display:
      - Generated DQDL rule (code block, copyable)
      - Reasoning explanation (why this rule)
      - False positive scenarios (warnings)
      - Suggested severity
    - "Accept and Create" button (creates rule with status='pending')
    - "Regenerate" button to try again
    - "Start Over" to clear form

    **src/components/features/rules/template-picker.tsx:**
    Industry template selection:
    - Grid of template cards by category (format, range, consistency, compliance)
    - Each card shows: name, description, example
    - Click to select, then configure parameters
    - Column selector for applying template
    - Preview of generated DQDL
    - "Apply Template" creates rule directly (status='pending' or skip approval option)

    **src/components/features/rules/rule-form.tsx:**
    Manual rule creation/edit form:
    - Dataset and column selectors
    - Rule type dropdown (completeness, uniqueness, range, pattern, freshness, referential, custom)
    - DQDL expression textarea with syntax highlighting hint
    - Description field
    - Severity selector (critical, warning, info)
    - For edit: show readonly fields if rule is 'active'
    - Validation: check DQDL syntax (basic bracket matching)

    **src/components/features/rules/rule-list.tsx:**
    Table of rules:
    - Columns: Name/Description, Column, Type, Severity, Status, Created, Actions
    - Status badges: pending (yellow), approved (blue), active (green), disabled (gray)
    - Filter bar: status, rule_type, severity
    - Bulk actions: approve selected, reject selected (for pending)
    - Click row to view detail
    - Delete action (with confirmation)

    **src/components/features/rules/approval-panel.tsx:**
    Pending rules approval interface:
    - Show rule details: DQDL expression, reasoning, source (AI/template/manual)
    - "Approve" button (green) - activates rule
    - "Reject" button (red) - with required comment
    - Comments textarea
    - Show who requested and when
    - Navigation to next pending rule

    **src/app/(dashboard)/rules/page.tsx:**
    - RuleList component
    - Tabs: All Rules, Pending Approval (with count badge)
    - "Create Rule" dropdown: AI Generator, From Template, Manual
    - Quick stats: total rules, active, pending, by severity

    **src/app/(dashboard)/rules/new/page.tsx:**
    - Query param determines mode: ?mode=ai|template|manual
    - AI mode: RuleGenerator component
    - Template mode: TemplatePicker component
    - Manual mode: RuleForm component
    - Breadcrumb: Rules > Create New Rule

    **src/app/(dashboard)/rules/[id]/page.tsx:**
    - Rule detail view
    - If pending: show ApprovalPanel
    - If active/approved: show rule details, edit button, validation history
    - Reasoning section (if AI-generated)
    - Link to run validation with this rule
  </action>
  <verify>
    cd frontend && npm run build
    # Check rule components exist
    ls frontend/src/components/features/rules/*.tsx | wc -l
    # Should be 5 (rule-form, rule-list, rule-generator, approval-panel, template-picker)
  </verify>
  <done>
    Rule management pages build successfully. AI generator calls DQ Recommender and displays reasoning. Approval panel supports approve/reject workflow. Template picker shows industry patterns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validation Results and Alert Dashboard</name>
  <files>
    frontend/src/app/(dashboard)/validations/page.tsx
    frontend/src/app/(dashboard)/validations/[id]/page.tsx
    frontend/src/app/(dashboard)/alerts/page.tsx
    frontend/src/app/(dashboard)/alerts/[id]/page.tsx
    frontend/src/components/features/validations/validation-list.tsx
    frontend/src/components/features/validations/validation-results.tsx
    frontend/src/components/features/validations/quality-score-card.tsx
    frontend/src/components/features/alerts/alert-list.tsx
    frontend/src/components/features/alerts/alert-detail.tsx
    frontend/src/hooks/use-validations.ts
    frontend/src/hooks/use-alerts.ts
  </files>
  <action>
    Create validation results viewer and alert management:

    **src/hooks/use-validations.ts:**
    - `useValidations(filters?)`: List validation_runs with filters (dataset_id, status)
    - `useValidation(id)`: Get single run with rule_results and quality_scores
    - `useTriggerValidation()`: Mutation to POST /api/validations
    - Poll for status when validation is 'running' (refetchInterval: 5000)
    - Proper query keys for cache management

    **src/hooks/use-alerts.ts:**
    - `useAlerts(filters?)`: List alerts with filters (status, severity, dataset_id)
    - `useAlert(id)`: Get single alert with details
    - `useAcknowledgeAlert()`: Mutation to PUT alert status
    - `useResolveAlert()`: Mutation to PUT alert status with resolution
    - `useOpenAlertCount()`: Get count of open alerts for badge
    - Real-time subscription to new alerts (optional: Supabase realtime)

    **src/components/features/validations/validation-list.tsx:**
    Table of validation runs:
    - Columns: Dataset, Status, Score, Passed/Failed, Triggered By, Started, Duration
    - Status badges: pending (gray), running (blue animated), completed (green/red based on score), failed (red)
    - Score as percentage with color gradient (green >80%, yellow 60-80%, red <60%)
    - Click row to view detail
    - "Run Validation" button opens dataset selector

    **src/components/features/validations/validation-results.tsx:**
    Detailed validation results:
    - Summary card: overall score, rules passed/failed, duration
    - Quality dimensions chart (radar or bar): completeness, validity, uniqueness, consistency, freshness
    - Rule results table:
      - Rule name, type, result (pass/fail/error), message
      - Expand to show sample failures if available
      - Filter by result (pass/fail)
    - Link to S3 full results (if available)

    **src/components/features/validations/quality-score-card.tsx:**
    Reusable score display:
    - Large score number with color
    - Trend indicator (up/down from previous run)
    - Dimension breakdown as small pills
    - Click to expand dimension details

    **src/components/features/alerts/alert-list.tsx:**
    Alert dashboard:
    - Stats row: Open (count), Critical (count), Warning (count)
    - Filter tabs: All, Open, Acknowledged, Resolved
    - Sort by: Severity (default), Created, Dataset
    - Alert cards (not table for better UX):
      - Severity icon (red exclamation for critical, yellow for warning, blue info)
      - Title and message preview
      - Dataset name, created time
      - Quick actions: Acknowledge, View
    - Real-time updates when new alerts arrive

    **src/components/features/alerts/alert-detail.tsx:**
    Full alert view:
    - Alert type badge (rule_failure, freshness_sla, volume_anomaly)
    - Full message and details JSON (formatted)
    - Related dataset link
    - Related rule link (if rule_failure)
    - Related validation link (if from validation run)
    - Status workflow:
      - Open -> Acknowledge (add acknowledgment note)
      - Acknowledged -> Resolve (add resolution notes, required)
      - Snooze option (temporary dismiss)
    - Timeline: created, acknowledged, resolved timestamps with who

    **src/app/(dashboard)/validations/page.tsx:**
    - ValidationList component
    - Filter bar: dataset, status, date range
    - "Run Validation" CTA button

    **src/app/(dashboard)/validations/[id]/page.tsx:**
    - ValidationResults component
    - Breadcrumb: Validations > Run {id}
    - Loading state while running (with live status)

    **src/app/(dashboard)/alerts/page.tsx:**
    - AlertList component
    - Prominent open alert count

    **src/app/(dashboard)/alerts/[id]/page.tsx:**
    - AlertDetail component
    - Breadcrumb: Alerts > Alert {id}

    **Update dashboard layout:**
    - Add navigation links: Rules, Validations, Alerts
    - Alert badge in nav showing open count
  </action>
  <verify>
    cd frontend && npm run build
    # Check all new components exist
    ls frontend/src/components/features/validations/*.tsx frontend/src/components/features/alerts/*.tsx | wc -l
    # Should be 5 (validation-list, validation-results, quality-score-card, alert-list, alert-detail)
  </verify>
  <done>
    Validation pages display run history and detailed results. Quality scores show dimension breakdown. Alert dashboard shows open alerts with severity. Status workflow allows acknowledge/resolve flow.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` succeeds
2. Rule generator component calls AI and displays reasoning
3. Approval panel supports approve/reject with comments
4. Validation results show rule-level pass/fail
5. Alert list displays with severity color coding
6. Navigation updated with Rules, Validations, Alerts links
7. All hooks properly cache and invalidate data
</verification>

<success_criteria>
- User can describe rule in natural language and see generated DQDL with reasoning
- User can pick from industry templates to create rules quickly
- Pending rules queue shows all AI-generated rules awaiting approval
- Approval panel displays reasoning and allows approve/reject with comments
- Validation results show overall score and per-rule breakdown
- Quality dimension scores display (completeness, validity, uniqueness, consistency, freshness)
- Alert dashboard shows open alerts sorted by severity
- Alert status can be updated: acknowledge, resolve with notes
- Navigation includes all new sections with alert badge count
- AI-02 satisfied: User can see AI-provided reasoning
- AI-03 satisfied: Industry templates available
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-quality-ai-recommendations/02-03-SUMMARY.md`
</output>
